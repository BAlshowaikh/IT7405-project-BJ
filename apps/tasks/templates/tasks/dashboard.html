{% extends "base_app.html" %}
{% load static %}

{% block content %}
<div class="px-10 py-10">
  
  <!-- header -->
  <header class="mb-8">
    <h1 class="text-3xl font-semibold text-slate-900">
      My Tasks Dashboard
    </h1>
    <p class="mt-1 text-sm text-slate-500">
      Welcome back, {{ username }} ðŸ‘‹
    </p>
  </header>

  <!-- Week's Statistics -->
  <section class="mb-10">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">
      Weekâ€™s Statistics
    </h2>

    <div class="grid gap-4 md:grid-cols-3">
      <!-- Tasks In Progress -->
      <div
        class="bg-[#0F172A] text-white rounded-2xl px-6 py-4
               flex items-center justify-between shadow-md"
      >
        <div>
          <p class="text-sm text-slate-300 mb-1">Tasks In progress (Currently Working On)</p>
          <p class="text-3xl font-bold" id="stat-in-progress">{{ tasks_in_progress_this_week }}</p>
        </div>
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-slate-800/70">
          <iconify-icon icon="mdi:timer-sand" class="text-xl"></iconify-icon>
        </div>
      </div>

      <!-- Completed Tasks -->
      <div
        class="bg-[#0F172A] text-white rounded-2xl px-6 py-4
               flex items-center justify-between shadow-md"
      >
        <div>
          <p class="text-sm text-slate-300 mb-1">Completed Tasks</p>
          <p class="text-3xl font-bold" id="stat-completed">{{ tasks_completed_this_week }}</p>
        </div>
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-emerald-500/15">
          <iconify-icon icon="mdi:check-circle" class="text-emerald-400 text-2xl"></iconify-icon>
        </div>
      </div>

      <!-- Upcoming Deadlines (Today) -->
      <div
        class="bg-[#0F172A] text-white rounded-2xl px-6 py-4
               flex items-center justify-between shadow-md"
      >
        <div>
          <p class="text-sm text-slate-300 mb-1">Upcoming Deadlines (Today)</p>
          <p class="text-3xl font-bold" id="stat-urgent-today">{{ tasks_urgent_today }}</p>
        </div>
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-rose-500/15">
          <iconify-icon icon="mdi:alert" class="text-rose-400 text-2xl"></iconify-icon>
        </div>
      </div>
    </div>
  </section>

  <!-- All Tasks -->
  <section>
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <h2 class="text-xl font-semibold text-slate-900">All Tasks</h2>
        <button
          id="open-add-task"
          type="button"
          class="inline-flex items-center gap-1 rounded-md border border-slate-300
                 bg-white px-3 py-1.5 text-xs font-medium text-slate-700
                 hover:bg-slate-50"
        >
          <span class="text-base leading-none">+</span>
          <span>Add Task</span>
        </button>
      </div>

      <div class="flex items-center gap-3">
        <div
          class="flex items-center gap-2 rounded-full border border-slate-300
                 bg-white px-3 py-1.5 text-xs text-slate-500 min-w-[200px]"
        >
          <iconify-icon icon="mdi:magnify" class="text-slate-400 text-base"></iconify-icon>
          <input
            id="task-search"
            type="text"
            placeholder="Search for task..."
            class="w-full bg-transparent text-xs text-slate-700 placeholder-slate-400 focus:outline-none"
          />
        </div>

        <button
          type="button"
          class="flex h-8 w-8 items-center justify-center rounded-full
                 border border-slate-300 bg-white text-slate-500 hover:bg-slate-50"
        >
          <iconify-icon icon="mdi:filter-variant" class="text-base"></iconify-icon>
        </button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mb-3 border-b border-slate-200 text-sm text-slate-500">
      <div class="flex gap-10" id="task-status-tabs">
        <button
          type="button"
          class="pb-2 border-b-2 border-sky-500 text-slate-900 font-medium"
          data-status="all"
        >
          All
        </button>
        <button
          type="button"
          class="pb-2 text-slate-500 hover:text-slate-900"
          data-status="in_progress"
        >
          In Progress
        </button>
        <button
          type="button"
          class="pb-2 text-slate-500 hover:text-slate-900"
          data-status="done"
        >
          Completed
        </button>
      </div>
    </div>


    <!-- Tasks table -->
    <div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
      <!-- Scrollable area for the table -->
      <div class="max-h-52 overflow-y-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wide text-slate-500">
            <tr class="text-left">
              <th class="px-6 py-3 font-medium">Task Title</th>
              <th class="px-6 py-3 font-medium">Priority</th>
              <th class="px-6 py-3 font-medium">Status</th>
            </tr>
          </thead>

          <tbody id="tasks-table-body" class="divide-y divide-slate-100">
            {% for task in tasks %}
              <tr data-task-id="{{ task.public_id}}" class="hover:bg-slate-50 cursor-pointer">
                <td class="px-6 py-3 text-slate-800">
                  <div class="flex items-center gap-3">
                    <input type="checkbox"
                          class="h-4 w-4 rounded border-slate-300 text-sky-500" />
                    <span class="text-sm font-medium">{{ task.title }}</span>
                  </div>
                </td>

                <td class="px-6 py-3">
                  {% if task.priority == 'high' %}
                    <span class="bg-rose-100 text-rose-600 px-3 py-1 text-xs rounded-full">High</span>
                  {% elif task.priority == 'low' %}
                    <span class="bg-emerald-100 text-emerald-600 px-3 py-1 text-xs rounded-full">Low</span>
                  {% else %}
                    <span class="bg-amber-100 text-amber-600 px-3 py-1 text-xs rounded-full">Mid</span>
                  {% endif %}
                </td>

                <td class="px-6 py-3">
                  {% if task.status == 'done' %}
                    <span class="bg-emerald-100 text-emerald-700 px-3 py-1 text-xs rounded-full">Completed</span>
                  {% elif task.status == 'in_progress' %}
                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 text-xs rounded-full">In Progress</span>
                  {% else %}
                    <span class="bg-slate-100 text-slate-700 px-3 py-1 text-xs rounded-full">To Do</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="3" class="px-6 py-6 text-center text-slate-400">
                  No tasks yet. Click <span class="font-medium text-slate-600">"Add Task"</span> to create your first one.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

      
    </div>
  </section>
</div>

{% include "tasks/_add_task_panel.html" %}
{% include "tasks/_task_details_panel.html" %}
{% include "tasks/_edit_task_panel.html" %}
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'tasks/js/dashboard.js' %}" defer></script>
{% endblock %}
