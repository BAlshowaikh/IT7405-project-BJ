{% extends "base_app.html" %}
{% load static %}

{% block content %}
<div class="flex-1 bg-slate-50">
  <div class="px-10 py-10">

    <header class="mb-8">
      <h1 class="text-3xl font-semibold text-slate-900">
        Tip Of Today
      </h1>
      <p class="mt-1 text-sm text-slate-500">
        Welcome back, {{ username }} ðŸ‘‹
      </p>
    </header>

    <!-- Layout wrapper for generator + tip card -->
    <div
      id="tips-layout"
      class="flex flex-col items-center gap-4 max-w-4xl mx-auto mb-8"
    >

      <!-- Generator card -->
      <div
        id="tip-generator-card"
        class="w-full md:w-1/2 rounded-3xl bg-white shadow-md border border-slate-200 px-8 py-6 flex flex-col items-center text-center"
      >
        <div class="flex items-center gap-2 mb-3">
          <span
            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-sky-100 text-sky-600"
          >
            <iconify-icon icon="lucide:brain" class="text-xl"></iconify-icon>
          </span>
          <span class="text-sm font-medium text-slate-600">
            Generating Tip...
          </span>
        </div>

        <p class="text-xs text-slate-400 mb-5">
          Click the button to generate a new productivity tip.
        </p>

        <button
          id="get-tip-btn"
          type="button"
          data-api-url="{% url 'tasks:get_tip_api' %}"
          class="inline-flex items-center justify-center px-6 py-2.5 rounded-full
                 bg-slate-900 text-white text-sm font-semibold
                 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 focus:ring-offset-white"
        >
          Get a new tip
        </button>

        <p
          id="tip-loading-text"
          class="mt-3 text-xs text-slate-400 hidden"
        >
          Generating tip...
        </p>
      </div>

      <!-- Tip display card (hidden until first tip is loaded) -->
      <div
        id="tip-display-card"
        class="w-full md:w-1/2 rounded-3xl bg-white shadow-md border border-slate-200 px-8 py-6 flex flex-col gap-4 hidden"
      >
        <div class="flex items-center justify-between">
          <span class="text-sm font-semibold text-slate-700">
            Todayâ€™s Tip
          </span>
          <button
            id="save-tip-btn"
            type="button"
            data-api-url="{% url 'tasks:save_tip_api' %}"
            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full
                   bg-slate-900 text-white text-xs font-medium
                   hover:bg-slate-800"
          >
            <iconify-icon icon="lucide:save" class="text-sm"></iconify-icon>
            Save Tip
          </button>
        </div>

        <p
          id="tip-text"
          class="text-sm leading-relaxed text-slate-800"
        ></p>

        <div class="flex items-center justify-between mt-2">
          <p
            id="tip-category"
            class="text-xs uppercase tracking-wide text-slate-400"
          ></p>
          <button
            id="close-tip-btn"
            type="button"
            class="px-4 py-1.5 rounded-full bg-slate-900 text-white text-xs font-medium hover:bg-slate-800"
          >
            Close
          </button>
        </div>

        <p
          id="tip-error"
          class="mt-2 text-xs text-rose-600 hidden"
        ></p>
        <p
          id="tip-success"
          class="mt-2 text-xs text-emerald-600 hidden"
        ></p>
      </div>

    </div>

    <!-- Saved Tips table -->
    <section class="mt-4">
      <h2 class="text-lg font-semibold text-slate-900 mb-3">
        Saved Tips
      </h2>

      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
        <div class="max-h-52 overflow-y-auto">
          <table class="min-w-full text-sm">
            <thead
              class="bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wide text-slate-500"
            >
              <tr class="text-left">
                <th class="px-6 py-3 font-medium">Tip</th>
                <th class="px-6 py-3 font-medium">Date Saved</th>
                <th class="px-6 py-3 font-medium text-right">Actions</th>
              </tr>
            </thead>

            <tbody id="saved-tips-table-body" class="divide-y divide-slate-100">
              {% for tip in saved_tips %}
                <tr data-tip-id="{{ tip.id }}" class="hover:bg-slate-50">
                  <td class="px-6 py-3 text-slate-800 align-top">
                    <p class="text-sm">{{ tip.text }}</p>
                  </td>
                  <td class="px-6 py-3 text-slate-500 text-xs align-top whitespace-nowrap">
                    {{ tip.created_at|date:"Y-m-d H:i:s" }}
                  </td>
                  <td class="px-6 py-3 text-right align-top">
                    <button
                      type="button"
                      class="inline-flex items-center justify-center rounded-full p-2 text-slate-400 hover:text-rose-500 delete-tip-btn"
                      title="Delete tip"
                    >
                      <iconify-icon icon="lucide:trash-2" class="text-lg"></iconify-icon>
                    </button>
                  </td>
                </tr>
              {% empty %}
                <tr id="saved-tips-empty-row">
                  <td colspan="3" class="px-6 py-6 text-center text-slate-400">
                    No tips saved yet. Generate a tip and click
                    <span class="font-medium text-slate-600">"Save Tip"</span>.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </div>
</div>

<script src="{% static 'tasks/js/tips.js' %}" defer></script>
{% endblock content %}
